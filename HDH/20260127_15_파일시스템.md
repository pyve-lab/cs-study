## 15-1. 파일과 디렉터리

### 1. 개요
- **파일과 디렉터리** : 보조기억장치에 저장된 데이터 덩어리일 뿐이나, 운영체제가 이것을 일목요연하게 관리해주는 것.
- **파일 시스템** : 파일과 디렉터리를 관리하는 운영체제 내의 프로그램
- 한 컴퓨터 내에 여러 개의 파일 시스템을 사용할 수도 있다.


### 2. 파일
- **파일** : 보조기억장치에 저장된 관련 정보의 집합. 의미 있는 정보들을 모은 논리적 단위.
- **파일의 이루는 정보** : 파일을 실행하기 위한 정보 + 부가 정보(속성. 메타 데이터)
- **파일의 속성** : 유형(운영체제가 인식하는 파일의 종류. 확장자), 크기, 보호, 생성 날짜 등


- 어떤 응용 프로그램도 임의로 파일에 접근하거나 파일을 조작할 수 없다!
- 즉, 파일을 다루려면 **시스템 호출을 통해 운영체제에게 부탁**해야 함.
- 파일 연산을 위한 시스템 호출 : 생성, 삭제, 열기, 닫기, 읽기, 쓰기 등 (대표적으로 6가지)


### 3. 디렉터리 (윈도우에서는 폴더)
- **1단계 디렉터리** : 하나의 디렉터리 안에 다양한 파일들이 존재하는 구조. 예전의 형태.
- **트리 구조 디렉터리** : 여러 계층으로 파일 및 폴더를 관리. 최상위 디렉터리(루트 디렉터리, /) 및 서브 디렉터리
- **경로** : 디렉터리를 이용해 파일/디렉터리의 위치, 나아가 이름까지 특정 지을 수 있는 정보. 디렉토리 경로가 다르면 동일한 이름의 파일이 존재할 수 있음.
- **절대 경로** : 루트 디렉터리에서 자기 자신까지 이르는 고유한 경로
- **상대 경로** : 현재 디렉터리에서 자기 자신까지 이르는 경로


- 어떤 응용 프로그램도 임의로 디렉터리 연산을 할 수는 없다. 이 경우에도 시스템 호출을 통해 운영체제에게 부탁해야 함.
- 디렉터리 연산을 위한 시스템 호출 : 생성, 삭제, 열기, 닫기, 읽기 등


- 많은 운영체제에서는 디렉터리를 그저 특별한 형태의 파일로 간주한다!
- 디렉터리 내부에는, 해당 디렉터리에 담겨 있는 대상과 관련된 정보들이 담겨 있다.
- 이 정보는 보통 테이블 형태로 구성된다.
- **디렉터리 엔트리** : 디렉터리에 포함된 대상의 이름, 그 대상이 보조기억장치 내에 저장된 위치(를 유추할 수 있는 정보)


---

## 15-2. 파일 시스템

### 1. 파티셔닝과 포매팅
- **파티셔닝** : 칸막이처럼 저장 장치의 논리적인 영역을 구획하는 작업. 이걸 통해 파티션이 나옴.
- **포매팅** : 파일 시스템을 설정하여, 어떤 방식으로 파일을 관리할지 결정하고, 새로운 데이터를 쓸 준비를 하는 작업.
- 파티션마다 어떤 파일 시스템을 사용할지 설정할 수도 있다.
- 포매팅까지 완료하여 파일 시스템을 설정했다면 이제 파일과 디렉토리 생성이 가능해진다.


- 하드디스크의 가장 작은 저장 단위는 **섹터**이나, 너무 개수가 많고 크기도 작기 때문에 파일 시스템이 모든 섹터를 관리하기가 어렵다.
- 따라서 운영체제는 파일/디렉터리를 **블록** 단위로 묶은 뒤 관리(읽고 씀)한다.
- 즉, 하나의 파일이 보조기억장치에 저장될 때에는 여러 블록에 걸쳐 저장된다.


### 2. 파일 할당 방법
- 여러 개의 블록에 걸쳐 파일을 할당하는 방법
- 연속 할당
- 불연속 할당


#### 2-1. 연속 할당
- 보조기억장치 내 **연속적인 블록**에 파일이 할당된다.
- 파일이 저장된 위치 식별을 위해 필요한 정보 : 첫 번째 블록 주소, 블록 단위의 길이 (디렉터리 엔트리에 파일 이름과 함께 저장됨)
- 구현이 단순하나 외부 단편화 문제 가능성
- **외부 단편화**란? 빈 공간은 충분한데 연속된 공간이 아니라 탑재 불가


#### 2-2. 불연속 할당
- 오늘날 주로 사용

- **연결 할당** : 각 블록의 일부에 다음 블록의 주소를 저장하여 각 블록이 다음 블록을 가리키는 형태로 할당
- 연결 할당은 파일을 이루는 데이터 블록을 **연결 리스트**로 관리한다.
- 연결 할당의 디렉터리 엔트리 : 파일 이름, 첫 번째 블록 주소, 블록 단위의 길이 
- 외부 단편화를 해결할 수 있으나, 임의 접근 속도가 느리다.
- 반드시 첫 번째 블록부터 하나씩 읽어들여야 함. (임의의 위치부터 파일을 읽어들이는 속도가 느림)
- 오류 발생시 해당 블록 이후 블록은 접근이 어렵다.

- **색인 할당** : 파일의 모든 블록 주소를 색인 블록이라는 하나의 블록에 모아 관리하는 방식
- 파일 내 임의의 위치에 접근하기 용이
- 색인 할당의 디렉터리 엔트리 : 파일 이름, 색인 블록 주소


### 3. FAT 파일 시스템
- **연결 할당 기반** 파일 시스템
- 연결 할당의 단점 보완 : **각 블록에 포함된 다음 블록 주소**를 한데 모아 테이블(FAT: File Allocation Table)로 관리
- **FAT가 메모리에 캐시**될 경우 느린 임의 접근 속도 개선 가능
- 디렉터리 엔트리 : 파일 이름, 확장자, 속성... 이렇게 **속성**(읽기 전용, 숨김 파일, 디렉터리 등)까지도 저장이 된다.
- 예약 영역 | FAT 영역 | 루트 디렉터리 영역 | 데이터 영역


### 4. 유닉스 파일 시스템
- **색인 할당 기반** 파일 시스템
- **색인 블록**을 **i-node**라고도 부르며, 파일의 속성 정보와 **15개의 블록** 주소 저장이 가능하다.


- 그렇다면 15개 블록 이상을 차지하는 경우는?
- 1. 블록 주소 중 **첫 번째 12개**에는 **직접 블록**(파일 데이터가 저장된 블록) 주소를 저장한다.
- 2. 1번으로 충분하지 않으면 **13번째 주소**에 **단일 간접 블록**(파일 데이터를 저장한 블록 주소가 저장된 블록) 주소를 저장한다.
- 3. 2번으로 충분하지 않으면 **14번째 주소**에 **이중 간접 블록**(단일 간접 블록들의 주소를 저장하는 블록) 주소를 저장한다.
- 4. 3번으로 충분하지 않으면 **15번째 주소**에 **삼중 간접 블록**(이중 간접 블록들의 주소를 저장하는 블록) 주소를 저장한다.


- 디렉터리 엔트리 : i-node가 파일 시스템의 핵심으로 i-node 번호, 파일 이름
- 예약 영역 | i-node 영역 | 데이터 영역

