# 교착 상태 해결 방법

## 1. 교착 상태 해결 방식 개요

교착 상태를 다루는 방법은 크게 **세 가지**가 있다.

1. **교착 상태 예방 (Prevention)**
2. **교착 상태 회피 (Avoidance)**
3. **교착 상태 검출 후 회복 (Detection & Recovery)**

추가로,

- **교착 상태를 무시하는 방법**도 존재한다.

---

## 2. 교착 상태 예방 (Deadlock Prevention)

### 개념

- **애초에 교착 상태가 발생하지 않도록 하는 방법**
- 교착 상태의 **4가지 발생 조건 중 하나라도 제거**

👉 교착 상태 발생은 원천적으로 막을 수 있지만,

👉 **부작용이 따르는 방식**

---

### 2-1. 상호 배제 조건 제거

- 모든 자원을 **공유 가능하게 만들기**

❌ 문제점

- 이론적으로는 가능
- 현실적으로는 불가능
    - 프린터, 파일, 임계 구역 등은 공유 불가

---

### 2-2. 점유와 대기 조건 제거

- 프로세스에 자원을
    - **모두 한 번에 할당**
    - 또는 **아예 할당하지 않음**

❌ 문제점

- 자원 활용률 저하
- 오랫동안 자원을 할당받지 못하는 프로세스 발생 가능
- 할당받은 자원을 사용하지 않아 **자원 낭비 발생**

---

### 2-3. 비선점 조건 제거

- **선점 가능한 자원에 한해** 강제로 자원 회수

⭕ 효과적인 경우

- CPU와 같은 선점 가능한 자원

❌ 문제점

- 모든 자원이 선점 가능한 것은 아님
- 범용적인 해결책이 되기 어려움

---

### 2-4. 원형 대기 조건 제거

- 모든 자원에 **번호를 부여**
- 자원을 **오름차순으로만 할당**

⭕ 효과

- 원형 대기 구조 발생 불가

❌ 문제점

- 자원에 번호를 매기는 것 자체가 어려움
- 번호 부여 방식에 따라 자원 활용률 달라짐

---

### 2-5. 예방 방식 정리

- 교착 상태 발생 ❌ (보장)
- 대신:
    - 자원 활용률 저하
    - 시스템 효율 감소
    - 현실 적용 어려움

---

## 3. 교착 상태 회피 (Deadlock Avoidance)

### 개념

- 교착 상태는
    - **무분별한 자원 할당 때문에 발생**한다고 간주
- 교착 상태가 발생하지 않도록
    - **조심스럽게 자원 할당**

👉 “될 수 있으면 주되, 위험하면 안 준다”

---

### 3-1. 안전 순서열 (Safe Sequence)

- **교착 상태 없이**
- 모든 프로세스에 자원을 할당할 수 있는 **실행 순서**

---

### 3-2. 안전 상태 (Safe State)

- **안전 순서열이 존재하는 상태**
- 모든 프로세스가
    - 교착 상태 없이
    - 자원을 할당받고 종료 가능

---

### 3-3. 불안전 상태 (Unsafe State)

- **안전 순서열이 존재하지 않는 상태**
- 교착 상태가 **발생할 가능성 있음**

---

### 3-4. 예시 상황 (책 예제)

- 전체 자원: **12개**
- 현재 할당 상태:
    - P1 → 5개
    - P2 → 2개
    - P3 → 2개
- 남은 자원: **3개**
- 최대 요구량:
    - P1 → 10개
    - P2 → 4개
    - P3 → 9개

---

### 안전 순서열 존재

- **P2 → P1 → P3**
    1. 남은 자원 3개 중 2개를 P2에 할당 → 작업 완료 후 반환
    2. 반환된 자원으로 P1 실행 → 완료 후 반환
    3. P3 실행 → 모든 프로세스 정상 종료

👉 **안전 상태**

---

### 안전 순서열이 없는 경우

- 자원을 잘못 배분하면
    - 더 이상 어떤 프로세스도 종료 불가
- 👉 **불안전 상태**
- 👉 교착 상태 발생 가능

---

### 3-5. 회피 방식의 핵심

- **안전 상태 → 안전 상태**로만 이동하도록 자원 할당
- 항상 시스템을 **안전 상태로 유지**

👉 대표적인 알고리즘: **은행원 알고리즘**

---

## 4. 교착 상태 검출 후 회복

(Deadlock Detection & Recovery)

### 개념

- 교착 상태 발생을 **인정**
- 발생한 뒤에 **사후 처리**

👉 예방·회피보다 단순하지만

👉 교착 상태 발생 비용 존재

---

### 동작 방식

1. 프로세스의 자원 요청을 **일단 허용**
2. 교착 상태 발생 여부 **검출**
3. 교착 상태가 발견되면 **회복 조치**

---

### 4-1. 선점을 통한 회복

- 교착 상태가 해결될 때까지
    - 한 프로세스씩 자원을 몰아줌
- 다른 프로세스의 자원을 **회수**

---

### 4-2. 프로세스 강제 종료를 통한 회복

### 방법 1. 모든 관련 프로세스 종료

- 교착 상태에 놓인 프로세스 **전부 종료**

❌ 문제점

- 작업 내역 모두 손실

---

### 방법 2. 하나씩 종료

- 교착 상태가 해결될 때까지
    - 프로세스를 **하나씩 강제 종료**

⭕ 장점

- 작업 손실 최소화

❌ 단점

- 반복적인 종료로 **오버헤드 발생**

---

## 5. 교착 상태 무시

### (타조 알고리즘, Ostrich Algorithm)

### 개념

- 교착 상태가
    - **거의 발생하지 않는다고 가정**
- 발생하더라도
    - 그냥 **무시**

👉 마치 타조가 위험을 무시하고 머리를 모래에 파묻는 것과 같다고 해서 붙은 이름

---

### 특징

- 구현이 가장 단순
- 실제 운영체제에서 사용되기도 함
    - 교착 상태 발생 빈도가 매우 낮은 경우

---

## 핵심 요약

- 교착 상태 해결 방법은 3가지
    - 예방
    - 회피
    - 검출 후 회복
- 예방: 발생 자체 차단 (부작용 큼)
- 회피: 안전 상태 유지 (은행원 알고리즘)
- 검출 후 회복: 발생 인정 후 처리
- 경우에 따라 **무시**하는 전략도 존재

---

## 한 줄 정리

> ❝ 교착 상태 해결은
> 
> 
> 발생을 막을 것인가,
> 
> 피할 것인가,
> 
> 아니면 발생 후 처리할 것인가의 선택이다 ❞
>