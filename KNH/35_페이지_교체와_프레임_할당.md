# 페이지 교체와 프레임 할당

## 1. 요구 페이징 (Demand Paging)

### 1-1. 요구 페이징이란?

- **요구 페이징**이란
    
    프로세스를 실행할 때 **필요한 페이지만 메모리에 적재**하는 방식
    
- 처음부터 모든 페이지를 메모리에 올리지 않음

👉 “필요해지면 그때 가져온다”

---

### 1-2. 요구 페이징의 특징

- 프로세스를 실행하기 위해
    - **모든 페이지가 메모리에 있을 필요 없음**
- 페이지가 실제로 필요해질 때
    - **페이지 폴트(Page Fault)** 발생
    - 해당 페이지를 메모리로 적재

---

### 1-3. 순수 요구 페이징

- 프로세스 시작 시
    - 어떤 페이지도 메모리에 적재하지 않음
- 실행 도중
    - 필요한 페이지가 생길 때마다 페이지 폴트 발생

👉 페이지 폴트는 많지만

👉 메모리 낭비는 최소화

---

## 2. 페이지 교체 (Page Replacement)

### 2-1. 페이지 교체가 필요한 이유

- 물리 메모리의 프레임 수는 **한정**
- 새로운 페이지를 적재해야 하는데
    - **빈 프레임이 없는 경우 발생**

👉 이때,

- **기존 페이지 중 하나를 내보내야 함**
- 이 과정을 **페이지 교체**라고 한다.

---

### 2-2. 페이지 교체 알고리즘이란?

- 어떤 페이지를 **쫓아낼지 결정하는 기준**
- 목표:
    - **페이지 폴트 횟수 최소화**

---

## 3. 페이지 교체 알고리즘

### 3-1. FIFO 페이지 교체 알고리즘

### 개념

- **First-In First-Out**
- 가장 먼저 메모리에 들어온 페이지를 교체

### 특징

- 구현이 단순
- 오래 있었다고 해서
    - 자주 사용되는 페이지는 아님

### 단점

- **벨레이디의 역설(Belady’s Anomaly)**
    - 프레임 수가 늘어나도
    - 페이지 폴트가 증가할 수 있음

---

### 3-2. 최적 페이지 교체 알고리즘 (OPT)

### 개념

- 앞으로 **가장 오랫동안 사용되지 않을 페이지**를 교체

### 특징

- 페이지 폴트 횟수 **이론적 최소**
- 성능 비교의 기준

### 단점

- 미래의 참조를 알아야 함
- **실제 구현 불가능**

---

### 3-3. LRU 페이지 교체 알고리즘

### 개념

- **Least Recently Used**
- 가장 **오랫동안 사용되지 않은 페이지**를 교체

### 특징

- 실제 사용 패턴을 잘 반영
- OPT에 가장 근접한 현실적인 방식

### 단점

- 구현 비용 발생
- 정확한 LRU 구현은 어려움

---

### 3-4. 클록(Clock) 페이지 교체 알고리즘

### 개념

- LRU를 **근사**한 알고리즘
- 원형 큐 + 참조 비트 사용

### 동작 방식

1. 포인터가 가리키는 페이지 확인
2. 참조 비트가 `1`이면 `0`으로 바꾸고 이동
3. 참조 비트가 `0`이면 해당 페이지 교체

### 특징

- 구현이 비교적 단순
- LRU의 현실적 대안

---

## 4. 계층적 페이징 (Hierarchical Paging)

### 4-1. 계층적 페이징이란?

- 페이지 테이블이 너무 커지는 문제를 해결하기 위한 방식
- **페이지 테이블을 여러 단계로 나눔**

👉 “페이지 테이블을 페이징한다”

---

### 4-2. 등장 배경

- 가상 주소 공간이 커질수록
    - 페이지 테이블 크기 증가
- 페이지 테이블 전체를
    - 항상 메모리에 두는 것은 비효율적

---

### 4-3. 특징

- 필요한 페이지 테이블만 메모리에 적재
- 메모리 낭비 감소
- 주소 변환 단계는 증가

---

## 5. 스레싱 (Thrashing)

### 5-1. 스레싱이란?

- 시스템이
    - **페이지 교체에만 대부분의 시간을 소비**
    - 실제 작업은 거의 수행하지 못하는 상태

👉 CPU는 바쁜데

👉 성능은 극단적으로 나쁨

---

### 5-2. 스레싱 발생 원인

- 프로세스가 필요로 하는 페이지 수에 비해
    - **프레임 수가 너무 적은 경우**
- 페이지 폴트가
    - 연속적으로 발생

---

### 5-3. 스레싱의 결과

- 페이지 폴트 폭증
- 디스크 I/O 증가
- CPU 이용률 감소
- 시스템 전체 성능 급락

---

## 6. 프레임 할당 (Frame Allocation)

### 6-1. 프레임 할당이란?

- 여러 프로세스가 실행될 때
    - **각 프로세스에 프레임을 얼마나 나눠줄지 결정**

👉 프레임 할당 방식은

스레싱과 밀접한 관련 있음

---

### 6-2. 균등 할당 (Equal Allocation)

- 모든 프로세스에
    - **동일한 수의 프레임 할당**

### 특징

- 구현이 단순
- 프로세스 크기 고려 ❌

---

### 6-3. 비례 할당 (Proportional Allocation)

- 프로세스 크기에 비례하여
    - 프레임 할당

### 특징

- 큰 프로세스에 더 많은 프레임
- 균등 할당보다 합리적

---

### 6-4. 작업 집합 (Working Set)

### 개념

- 프로세스가
    - **일정 시간 동안 실제로 사용하는 페이지 집합**

---

### 작업 집합 기반 할당

- 각 프로세스의 작업 집합 크기에 맞게
    - 프레임 할당
- 필요한 프레임을 충분히 주면
    - 스레싱 방지 가능

---

## 핵심 요약

- 요구 페이징: 필요한 페이지만 적재
- 페이지 교체: 빈 프레임이 없을 때 기존 페이지 교체
- FIFO, OPT, LRU, Clock 알고리즘
- 계층적 페이징으로 페이지 테이블 크기 문제 해결
- 스레싱은 페이지 교체 과다 상태
- 프레임 할당 방식이 스레싱에 큰 영향

---

## 한 줄 정리

> ❝ 페이지 교체와 프레임 할당은
> 
> 
> 가상 메모리의 성능을 좌우하는 핵심 요소이다 ❞
>